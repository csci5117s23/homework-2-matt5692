/** @jsxImportSource @emotion/react */
import { header } from "@/styles/styles";
import { useState, useEffect } from "react";
import { TodoList } from "@/components/todo";
import Head from 'next/head'
import { useAuth } from "@clerk/nextjs";
import { getTodo } from "@/modules/Data";

export default function Done(){
    const [todoItemList, setTodoItemList] = useState([]);
    const [loading, setLoading] = useState(true);
    const { isLoaded, userId, sessionId, getToken } = useAuth();

    useEffect(() => {
        async function process() {
          if (userId) {
            const token = await getToken({ template: "codehooks" });
            const todoList = await getTodo(token);
            //sort based on slack discussion by Anwaar Hadi
            setTodoItemList(todoList.sort((a, b) => (a.createdOn <= b.createdOn) ? 1 : -1).filter(todoItem => todoItem.done));
            setLoading(false);
          }
        }
        process();
      }, [isLoaded]);

    function update(newList){
      //sort based on slack discussion by Anwaar Hadi
      setTodoItemList(newList.sort((a, b) => (a.createdOn <= b.createdOn) ? 1 : -1).filter(todoItem => todoItem.done));
    }

    if(loading){
        return(<><span>LOADING</span></>);
    } else{
    return (
        <>
          <Head>
            <title>Done items</title>
            <meta name="description" content="Generated by create next app" />
            <meta name="viewport" content="width=device-width, initial-scale=1" />
            <link rel="icon" href="/favicon.ico" />
          </Head>
          <div className="pure-g">
                <div className="pure-u-1" css={header}>
                    <h2>Your done items</h2>
                    <TodoList todoItems={todoItemList} updateList={update}></TodoList>
                </div>
          </div>
        </>
      )
    }
}